{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\froman\fcharset0 TimesNewRomanPS-BoldMT;\f1\froman\fcharset0 TimesNewRomanPS-ItalicMT;\f2\froman\fcharset0 TimesNewRomanPSMT;
\f3\ftech\fcharset77 Symbol;\f4\fswiss\fcharset0 Helvetica-Bold;\f5\fswiss\fcharset0 Helvetica;
\f6\froman\fcharset0 Times-Bold;\f7\froman\fcharset0 Times-Roman;\f8\fnil\fcharset0 AppleColorEmoji;
\f9\fnil\fcharset0 LucidaGrande;}
{\colortbl;\red255\green255\blue255;\red7\green8\blue10;\red8\green9\blue10;\red130\green57\blue3;
}
{\*\expandedcolortbl;;\csgenericrgb\c2745\c3137\c3922;\csgenericrgb\c3137\c3529\c3922;\csgenericrgb\c50980\c22353\c1176;
}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid1\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid101\'02\'00.;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid201\'02\'00.;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid301\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid401\'02\'00.;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid402\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid501\'02\'00.;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid502\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid6}
{\list\listtemplateid7\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid601\'02\'00.;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid602\'02\'01.;}{\levelnumbers\'01;}\fi-360\li1440\lin1440 }{\listname ;}\listid7}
{\list\listtemplateid8\listhybrid{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid701\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li720\lin720 }{\listlevel\levelnfc23\levelnfcn23\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{disc\}}{\leveltext\leveltemplateid702\'01\uc0\u8226 ;}{\levelnumbers;}\fi-360\li1440\lin1440 }{\listname ;}\listid8}
{\list\listtemplateid9\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid801\'02\'00.;}{\levelnumbers\'01;}\fi-360\li720\lin720 }{\listlevel\levelnfc0\levelnfcn0\leveljc0\leveljcn0\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid802\'02\'01.;}{\levelnumbers\'01;}\fi-360\li1440\lin1440 }{\listname ;}\listid9}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}{\listoverride\listid7\listoverridecount0\ls7}{\listoverride\listid8\listoverridecount0\ls8}{\listoverride\listid9\listoverridecount0\ls9}}
{\info
{\author Isak Griffiths}}\margl1440\margr1440\vieww26620\viewh16140\viewkind1\viewscale188
\deftab720
\pard\pardeftab720\ri0\sb100\sa100\partightenfactor0

\f0\b\fs27 \cf0 Prompt 1:\'a0Repository Deep Dive & Dependency Mapping\
\pard\pardeftab720\ri0\sb100\sa100\partightenfactor0

\f1\i\b0\fs24 \cf0 Objective: Understand current architecture before touching anything
\f2\i0 \
Ask Replit to analyze:\
\pard\tx720\pardeftab720\li720\fi-360\ri0\sb100\sa100\partightenfactor0
\ls1\ilvl0
\f3\fs20 \cf0 {\listtext	\'a5	}\'a5	
\f2\fs24 Current agent orchestration flow (how Noah coordinates the 3 agents)\
\ls1\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f2\fs24 Existing RAG implementation (structure, data sources, query patterns)\
\ls1\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f2\fs24 Agent communication patterns and state management\
\ls1\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f2\fs24 Current file structure and separation of concerns\
\ls1\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f2\fs24 Identify integration points where MCPs can hook in cleanly\
\ls1\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f2\fs24 Document Noah's personality implementation (where/how is persona maintained?)\
\pard\pardeftab720\ri0\sb100\sa100\partightenfactor0

\f0\b \cf0 Output needed:
\f2\b0 \'a0Architecture diagram, dependency map, "safe touch points" for integration\
\
\
\pard\pardeftab720\ri0\sb100\sa100\partightenfactor0

\f0\b\fs27 \cf0 Prompt 1 OUTPUT :\'a0Repository Deep Dive & Dependency Mapping
\f2\b0\fs24 \
\pard\pardeftab720\li2160\ri0\partightenfactor0

\f4\b\fs21 \cf2 Key Finding
\f5\b0 : Orchestration is\'a0
\f4\b manual and sequential
\f5\b0 \'a0- no structured planner. Agents don't share conversation state beyond session-scoped artifacts.
\f4\b \
\
Agent\'a0Orchestration\'a0Flow\
\pard\pardeftab720\li2160\ri0\partightenfactor0

\f2\b0\fs24 \cf0 Frontend Timeline\
    \uc0\u8595 \
/api/chat route (Central Orchestrator)\
    \uc0\u8595 \
[NoahSafetyService Check] \uc0\u8594  [UnifiedSession Extract]\
    \uc0\u8595 \
ProviderFactory (selects LLM model)\
    \uc0\u8595 \
SharedResourceManager (initializes RAG + ToolKnowledge)\
    \uc0\u8595 \
\uc0\u9484 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9488 \
\uc0\u9474  Agent Dispatch (manual/sequential):    \u9474 \
\uc0\u9474   \'95 Noah Core (in route.ts)             \u9474 \
\uc0\u9474   \'95 Wanderer Agent (research)           \u9474 \
\uc0\u9474   \'95 Tinkerer Agent (implementation)     \u9474 \
\uc0\u9492 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9472 \u9496 \
    \uc0\u8595 \
ArtifactService + Analytics + streamText Response\
\
\pard\pardeftab720\li2160\ri0\partightenfactor0

\f0\b\fs22 \cf3 RAG Implementation Structure\
\pard\pardeftab720\li2160\ri0\partightenfactor0

\f2\b0 \cf3 Current State: STUB IMPLEMENTATION\
\pard\tx220\tx720\pardeftab720\li2340\fi-180\ri0\partightenfactor0
\ls2\ilvl0\cf3 {\listtext	1.	}\'95	ChromaDB Integration: \cf4 knowledge-singleton.ts\cf3  returns empty results - RAG path exists but inactive\
{\listtext	2.	}\'95	Vector Storage: ChromaDB on port 8000, but not connected to agent queries\
{\listtext	3.	}\'95	Only Active Knowledge: \cf4 ToolKnowledgeService\cf3  (Postgres-backed) used exclusively by Tinkerer for code generation\
\pard\pardeftab720\li2340\fi-180\ri0\partightenfactor0
\cf3 Wanderer Agent: Operates on pure LLM context - ignores shared RAG resources\
\
\pard\tx916\tx1832\tx2748\tx3664\tx4580\tx5496\tx6412\tx7328\tx8244\tx9160\tx10076\tx10992\tx11908\tx12824\tx13740\tx14656\pardeftab720\li2160\ri0\partightenfactor0

\f6\b\fs21 \cf2 Structure\
\pard\tx916\tx1832\tx2748\tx3664\tx4580\tx5496\tx6412\tx7328\tx8244\tx9160\tx10076\tx10992\tx11908\tx12824\tx13740\tx14656\pardeftab720\li2160\ri0\partightenfactor0

\f7\b0 \cf2 SharedResourceManager\
  
\f2 \uc0\u8595 
\f7 \
  
\f2 \uc0\u9500 \u9472 
\f7  ProductionRAGIntegration (knowledge-singleton) 
\f2 \uc0\u8594 
\f7  ChromaDB [STUB]\
  
\f2 \uc0\u9492 \u9472 
\f7  ToolKnowledgeService 
\f2 \uc0\u8594 
\f7  Postgres 
\f2 \uc0\u8594 
\f7  Tool library metadata [ACTIVE]\
\pard\pardeftab720\li2340\fi-180\ri0\partightenfactor0

\f2\fs22 \cf0 \
\pard\pardeftab720\li2340\fi-180\ri0\partightenfactor0

\f0\b \cf0 Agent Communication Patterns
\f2\b0 \

\f0\b Agent Roles
\f2\b0 :\
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls3\ilvl0
\f0\b \cf0 {\listtext	1.	}1.	Noah Core
\f2\b0 \'a0(route.ts\'a0lines 335-651): Direct conversation, safety checks, persona enforcement\
\ls3\ilvl0
\f0\b {\listtext	2.	}2.	Wanderer
\f2\b0 \'a0(wanderer-agent.ts): Research specialist, fast responses,\'a0
\f0\b ignores shared resources
\f2\b0 \
\ls3\ilvl0
\f0\b {\listtext	3.	}3.	Tinkerer
\f2\b0 \'a0(practical-agent.ts): Implementation specialist,\'a0
\f0\b only agent using ToolKnowledgeService
\f2\b0 \
\pard\pardeftab720\li2340\fi-180\ri0\partightenfactor0
\cf0 \
\pard\pardeftab720\li2340\fi-180\ri0\partightenfactor0

\f0\b \cf0 Communication
\f2\b0 :\
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls4\ilvl0
\f3\fs20 \cf0 {\listtext	\'a5	}\'a5	
\f0\b\fs22 Shared State
\f2\b0 : Session ID, artifact map, safety flags\
\ls4\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f0\b\fs22 Isolated State
\f2\b0 : Each agent's LLM context, prompt templates\
\ls4\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f0\b\fs22 Response Streaming
\f2\b0 : Via\'a0streamText\'a0- no agent-tagged multiplexing\
\ls4\ilvl0
\f3\fs20 {\listtext	\'a5	}\'a5	
\f0\b\fs22 No Cross-Agent Coordination
\f2\b0 : Agents don't communicate with each other\
\pard\pardeftab720\li2340\fi-180\ri0\partightenfactor0
\cf0 \
\pard\pardeftab720\li2340\fi-180\ri0\partightenfactor0

\f4\b\fs21 \cf2 File Structure & Separation of Concerns
\f2\b0\fs22 \cf0 \
src/\
\uc0\u9500 \u9472 \u9472  app/\
\uc0\u9474    \u9500 \u9472 \u9472  api/\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  chat/route.ts          \u8592  Central orchestrator\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  artifacts/route.ts      \u8592  Artifact retrieval\
\uc0\u9474    \u9474    \u9492 \u9472 \u9472  knowledge/route.ts      \u8592  RAG endpoint\
\uc0\u9474    \u9492 \u9472 \u9472  page.tsx                    \u8592  Frontend state management\
\uc0\u9474 \
\uc0\u9500 \u9472 \u9472  lib/\
\uc0\u9474    \u9500 \u9472 \u9472  agents/\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  base-agent.ts           \u8592  Agent interface\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  practical-agent.ts      \u8592  Tinkerer implementation\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  wanderer-agent.ts       \u8592  Research implementation\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  shared-resources.ts     \u8592  RAG/Tool knowledge wiring\
\uc0\u9474    \u9474    \u9492 \u9472 \u9472  types.ts                \u8592  Agent type definitions\
\uc0\u9474    \u9474 \
\uc0\u9474    \u9500 \u9472 \u9472  knowledge/\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  knowledge-singleton.ts  \u8592  ChromaDB integration [STUB]\
\uc0\u9474    \u9474    \u9492 \u9472 \u9472  tool-reference-service.ts \u8592  Postgres tool metadata\
\uc0\u9474    \u9474 \
\uc0\u9474    \u9500 \u9472 \u9472  safety/\
\uc0\u9474    \u9474    \u9500 \u9472 \u9472  safety-service.ts       \u8592  Noah personality + ethics\
\uc0\u9474    \u9474    \u9492 \u9472 \u9472  content-filter.ts       \u8592  Trust/skeptic filtering\
\uc0\u9474    \u9474 \
\uc0\u9474    \u9500 \u9472 \u9472  session/\
\uc0\u9474    \u9474    \u9492 \u9472 \u9472  unified-session.ts      \u8592  Session state extraction\
\uc0\u9474    \u9474 \
\uc0\u9474    \u9492 \u9472 \u9472  providers/\
\uc0\u9474        \u9492 \u9472 \u9472  provider-factory.ts     \u8592  LLM model selection\
\
\
\

\f4\b\fs21 \cf2 Separation Quality
\f5\b0 : 
\f8 \uc0\u9989 
\f5 \'a0
\f4\b Clear
\f5\b0 \'a0- API routes separate from services, agents isolated, but\'a0
\f4\b tight coupling
\f5\b0 \'a0to environment variables (DATABASE_URL, CHROMA_URL)\
\
\
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f6\b \cf2 Safe MCP Integration Touch Points
\f5\b0 \
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f8 \cf2 \uc0\u9989 
\f6\b  Recommended Integration Points
\f7\b0 :
\f5 \
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls5\ilvl0
\f6\b\fs20 \cf2 {\listtext	1.	}1.	shared-resources.ts
\fs21 \'a0
\f0 \uc0\u8594 
\f6 \'a0
\fs20 initializeResources()
\f7\b0\fs21 \
\pard\tx4320\pardeftab720\li2880\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Why
\f5\b0 : Central RAG initialization point\
\ls5\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f4\b\fs21 How
\f5\b0 : Extend\'a0
\f7\fs20 ProductionRAGIntegration.search()
\f5\fs21 \'a0to call MCP context providers\
\ls5\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Risk Level
\f5\b0 : 
\f8 \uc0\u55357 \u57314 
\f5  LOW - isolated from safety checks\
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f6\b\fs20 \cf2 {\listtext	\'95	}2.	tool-reference-service.ts
\fs21 \'a0
\f0 \uc0\u8594 
\f6  Pre-Postgres Query
\f7\b0 \
\pard\tx4320\pardeftab720\li2880\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Why
\f5\b0 : Tool knowledge enrichment\
\ls5\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f4\b\fs21 How
\f5\b0 : Add MCP adapter before database query\
\ls5\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Risk Level
\f5\b0 : 
\f8 \uc0\u55357 \u57314 
\f5  LOW - already used by Tinkerer only\
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f6\b\fs20 \cf2 {\listtext	\'95	}3.	unified-session.ts
\fs21 \'a0
\f0 \uc0\u8594 
\f6  Session Extraction
\f7\b0 \
\pard\tx4320\pardeftab720\li2880\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Why
\f5\b0 : Shared state across agents\
\ls5\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f4\b\fs21 How
\f5\b0 : Add MCP session context to session object\
\ls5\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Risk Level
\f5\b0 : 
\f8 \uc0\u55357 \u57313 
\f5  MEDIUM - affects all agents\
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f6\b\fs20 \cf2 {\listtext	\'95	}4.	/api/chat/route.ts
\fs21 \'a0
\f0 \uc0\u8594 
\f6  Pre-Agent Dispatch
\f7\b0 \
\pard\tx4320\pardeftab720\li2880\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Why
\f5\b0 : Add orchestration planner/controller\
\ls5\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f4\b\fs21 How
\f5\b0 : Insert MCP tool call coordinator before agent invocation\
\pard\tx5040\pardeftab720\li2880\fi-360\ri0\partightenfactor0
\ls5\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f4\b\fs21 Risk Level
\f5\b0 : 
\f8 \uc0\u55357 \u56628 
\f5  HIGH - must preserve safety pipeline\
\pard\pardeftab720\li1440\ri0\partightenfactor0
\cf0 \
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f8 \cf2 \uc0\u55356 \u57261 
\f7 \'a0
\f6\b Noah's Personality Implementation
\f5\b0 \
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f6\b \cf2 Where Noah Lives
\f7\b0 :
\f5 \
\pard\tx5040\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls6\ilvl1
\f6\b\fs20 \cf2 {\listtext	\'95	}1.	safety-service.ts
\f7\b0\fs21 \'a0(Lines 335, 651 in route.ts):\
\pard\tx4320\pardeftab720\li2880\fi-360\ri0\sb100\partightenfactor0
\ls6\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f5\fs21 Trust protocols\
\ls6\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 Skeptic mode enforcement\
\ls6\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 "Radio silence" rules\
\ls6\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 Content filtering\
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls6\ilvl1
\f6\b\fs20 \cf2 {\listtext	\'95	}2.	ai-config.ts
\f7\b0\fs21 \'a0(System prompts):\
\pard\tx4320\pardeftab720\li2880\fi-360\ri0\sb100\partightenfactor0
\ls6\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f5\fs21 Core personality traits\
\ls6\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 Conversational tone\
\ls6\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 Trust recovery language\
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls6\ilvl1
\f6\b\fs20 \cf2 {\listtext	\'95	}3.	content-filter.ts
\f7\b0\fs21 :\
\pard\tx4320\pardeftab720\li2880\fi-360\ri0\sb100\partightenfactor0
\ls6\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f5\fs21 Trust/skeptic flag handling\
\ls6\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 Response modification based on mode\
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f6\b \cf2 Persona Enforcement Flow
\f7\b0 :
\f5 \
\pard\tx916\tx1832\tx2748\tx3664\tx4580\tx5496\tx6412\tx7328\tx8244\tx9160\tx10076\tx10992\tx11908\tx12824\tx13740\tx14656\pardeftab720\li1440\ri0\partightenfactor0

\f7 \cf2 User Message 
\f2 \uc0\u8594 
\f7  NoahSafetyService.beforeResponse()\
                    
\f2 \uc0\u8595 
\f7 \
            Check trust flags + skeptic mode\
                    
\f2 \uc0\u8595 
\f7 \
            Apply personality constraints\
                    
\f2 \uc0\u8595 
\f7 \
            LLM generates with Noah persona\
                    
\f2 \uc0\u8595 
\f7 \
        NoahSafetyService.afterResponse()\
                    
\f2 \uc0\u8595 
\f7 \
            Filter/modify based on guardrails\
                    
\f2 \uc0\u8595 
\f7 \
            Log to analytics\
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f5 \cf0 \
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f8 \cf2 \uc0\u9888 \u65039 
\f7 \'a0
\f6\b Risk Assessment for MCP Integration
\f5\b0 \
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f6\b \cf2 Critical Risks
\f7\b0 :
\f5 \
\pard\tx3600\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls7\ilvl1
\f8 \cf2 {\listtext	1.	}1
\f5 .
\f8 	\uc0\u55357 \u56628 
\f4\b  Safety Bypass
\f5\b0 : Integrating MCP at chat route could skip\'a0
\f7\fs20 NoahSafetyService
\f5\fs21 \'a0checks\
\pard\tx2160\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls7\ilvl1
\f8 \cf2 {\listtext	2.	}2
\f5 .
\f8 	\uc0\u55357 \u57313 
\f4\b  RAG Errors
\f5\b0 :\'a0
\f7\fs20 knowledge-singleton
\f5\fs21 \'a0is a stub - enabling MCP RAG needs async error handling\
\ls7\ilvl1
\f8 {\listtext	3.	}3
\f5 .
\f8 	\uc0\u55357 \u57313 
\f4\b  Stream Blocking
\f5\b0 : Incorrect MCP integration could stall\'a0
\f7\fs20 streamText
\f5\fs21 \'a0responses\
\ls7\ilvl1
\f8 {\listtext	4.	}4
\f5 .
\f8 	\uc0\u55357 \u57314 
\f4\b  Tool Knowledge
\f5\b0 : Extending\'a0
\f7\fs20 ToolKnowledgeService
\f5\fs21 \'a0is safest - already isolated to Tinkerer\
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f6\b \cf2 Critical Coupling Points
\f7\b0 :
\f5 \
\pard\tx2160\pardeftab720\li2160\fi-360\ri0\sb100\partightenfactor0
\ls8\ilvl1
\f3\fs20 \cf2 {\listtext	\'a5	}\'a5	
\f5\fs21 ProviderFactory 
\f9 \uc0\u8592 
\f5  Environment variables\
\ls8\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 SharedResourceManager 
\f9 \uc0\u8592 
\f5  DATABASE_URL, CHROMA_URL\
\ls8\ilvl1
\f3\fs20 {\listtext	\'a5	}\'a5	
\f5\fs21 ToolKnowledgeService 
\f9 \uc0\u8592 
\f5  Postgres connection pool\
\pard\pardeftab720\li1440\ri0\partightenfactor0
\cf0 \
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f8 \cf2 \uc0\u55357 \u56523 
\f7 \'a0
\f6\b Next Steps for MCP Integration
\f5\b0 \
\pard\tx2160\pardeftab720\li2160\fi-360\ri0\partightenfactor0
\ls9\ilvl1
\f4\b \cf2 {\listtext	1.	}1.	Formalize orchestration
\f5\b0 \'a0in\'a0
\f7\fs20 /api/chat/route.ts
\f5\fs21 \'a0- add planner/strategy selector\
\ls9\ilvl1
\f4\b {\listtext	2.	}2.	Replace RAG stub
\f5\b0 \'a0- make\'a0
\f7\fs20 knowledge-singleton
\f5\fs21 \'a0actually query ChromaDB or MCP providers\
\ls9\ilvl1
\f4\b {\listtext	3.	}3.	Define MCP adapter interfaces
\f5\b0 \'a0in\'a0
\f7\fs20 shared-resources.ts
\f5\fs21 \'a0for standardized integration\
\ls9\ilvl1
\f4\b {\listtext	4.	}4.	Update Wanderer
\f5\b0 \'a0to consume shared RAG results instead of ignoring them\
\ls9\ilvl1
\f4\b {\listtext	5.	}5.	Test safety preservation
\f5\b0 \'a0- ensure MCP paths still flow through\'a0
\f7\fs20 NoahSafetyService
\f5\fs21 \
\pard\pardeftab720\li1440\ri0\partightenfactor0
\cf0 \
\pard\pardeftab720\li1440\ri0\partightenfactor0

\f4\b \cf2 Bottom Line
\f5\b0 : Noah's architecture has clean separation but\'a0
\f4\b shallow agent coordination
\f5\b0 . The safest MCP integration path is through\'a0
\f7\fs20 shared-resources.ts
\f5\fs21 \'a0
\f9 \uc0\u8594 
\f5  extend RAG/tool knowledge systems without touching the safety pipeline. The biggest gap is the\'a0
\f4\b inactive ChromaDB RAG
\f5\b0 \'a0- MCP could fill this vacuum.\
}